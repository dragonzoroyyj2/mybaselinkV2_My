<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
  <meta charset="UTF-8">
  <!-- âœ… ë·°í¬íŠ¸ ì„¤ì •: ì¶•ì†Œ ë°©ì§€ ë° í™•ëŒ€(300%ê¹Œì§€) í—ˆìš© -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0">
  <title th:text="${title} ?: 'MyBaseLink'">MyBaseLink</title>

  <!-- ğŸš¨ğŸš¨ğŸš¨ ì´ì „ì˜ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ë¸”ë¡ì€ commonLayout.cssë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸš¨ğŸš¨ğŸš¨ -->

  <!-- âœ… CSRF Token -->
  <th:block th:if="${_csrf} != null">
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
  </th:block>

  <!-- âœ… í°íŠ¸ ë° ì•„ì´ì½˜ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- âœ… íŒŒë¹„ì½˜ (ëª¨ë“  í”Œë«í¼ ëŒ€ì‘) -->
  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!-- âœ… ê³µí†µ CSS ë¡œë“œ ìˆœì„œ (v12.6 ê¸°ì¤€) -->
  <link rel="stylesheet" href="/css/common/commonLayout.css">      <!-- â‘  ì „ì²´ ë ˆì´ì•„ì›ƒ / ë²„íŠ¼ / ëª¨ë‹¬ -->
  <link rel="stylesheet" href="/css/common/commonTable.css">       <!-- â‘¡ í…Œì´ë¸” / ë¡œë”©ì˜¤ë²„ë ˆì´ / ì²´í¬ë°•ìŠ¤ -->
  <link rel="stylesheet" href="/css/common/commonSearch.css">      <!-- â‘¢ ê²€ìƒ‰ì°½ / í•„í„° ì „ìš© -->
  <link rel="stylesheet" href="/css/common/commonPagination.css">  <!-- â‘£ í˜ì´ì§• ë²„íŠ¼ ì „ìš© -->
  <link rel="stylesheet" href="/css/common/commonModal.css">	   <!--  ëª¨ë‹¬ ì „ìš© -->
  <link rel="stylesheet" href="/css/common/commonToast.css">       <!-- ë©”ì„¸ì§€ ì „ìš© -->
  <link rel="stylesheet" href="/css/common/commonTop.css">        <!-- â‘¤ ìƒë‹¨ ë°”/í”„ë¡œí•„ ì „ìš© (ìƒˆë¡œ ì¶”ê°€) -->
  <link rel="stylesheet" href="/css/common/commonLeft.css">        <!-- ì¢Œì¸¡ ë©”ë‰´(ì‚¬ì´ë“œë°”) ì „ìš© -->

</head>

<body>

  <!-- âœ… ìƒë‹¨ -->
  <th:block th:replace="~{fragments/top :: topFragment}"></th:block>

  <!-- âœ… ì˜¤ë²„ë ˆì´ -->
  <div id="sidebarOverlay"></div>

  <!-- âœ… ì™¼ìª½ ë©”ë‰´ -->
  <div th:replace="~{fragments/left :: leftFragment}"></div>

  <!-- âœ… ë©”ì¸ ì½˜í…ì¸  -->
  <main>
    <div class="content" layout:fragment="content"></div>
  </main>

  <!-- âœ… í•˜ë‹¨ -->
  <footer th:replace="~{fragments/bottom :: bottomFragment}"></footer>

  <!-- âœ… ì „ì—­ ì‚¬ì´ë“œë°” í† ê¸€ -->
  <script>
  /*
  | êµ¬ë¶„          | í™”ë©´í­(px)          | ë””ë°”ì´ìŠ¤ ì˜ˆì‹œ             | ë°˜ì‘í˜• ëª©ì                		|
	| ----------- 	| ------------------- | ------------------------- | -------------------- 				|
	| **ì´ˆì†Œí˜•í°** | `max-width: 360px`  | iPhone SE, Galaxy A10e    | ìµœì†Œ ëŒ€ì‘ (ê¸°ë³¸ í…ìŠ¤íŠ¸/ë²„íŠ¼ ì¶•ì†Œ) |
	| **ì†Œí˜•í°** | `max-width: 480px`  | Galaxy S8, iPhone 12 mini | ëª¨ë°”ì¼ ì„¸ë¡œ ëª¨ë“œ ê¸°ì¤€         	|
	| **ì¤‘í˜•í°** | `max-width: 768px`  | ëŒ€ë¶€ë¶„ ìŠ¤ë§ˆíŠ¸í°, ì„¸ë¡œ     | ë ˆì´ì•„ì›ƒ ì—¬ë°±, í°íŠ¸ ìë™ì¡°ì •     |
	| **íƒœë¸”ë¦¿** | `max-width: 1024px` | iPad, Galaxy Tab ì„¸ë¡œ     | ë¦¬ìŠ¤íŠ¸/í¼ í­ ì¡°ì ˆ           		|
	| **ë°ìŠ¤í¬íƒ‘ ê¸°ë³¸** | `> 1024px`      | ë…¸íŠ¸ë¶/PC             	 | ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ìœ ì§€           		|
  */

  document.addEventListener("DOMContentLoaded", () => {
    // ğŸš¨ ì£¼ì˜: DOMContentLoaded ì‹œì ì—ì„œ left.htmlì˜ ìš”ì†Œê°€ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.
    const sidebar = document.querySelector(".sidebar");
    const overlay = document.getElementById("sidebarOverlay");
    const allSubmenuContainers = document.querySelectorAll(".sidebar li.has-submenu");
    const SIDEBAR_STATE_KEY = "sidebar_open_state";

    // âœ… ëª¨ë“  ì„œë¸Œë©”ë‰´ ë‹«ê¸° í•¨ìˆ˜ (left.htmlê³¼ ì¶©ëŒ ë°©ì§€ ìœ„í•´ ì—¬ê¸°ì— í†µí•©)
    function closeAllSubmenus(exceptActive = false) {
        allSubmenuContainers.forEach(container => {
            if (exceptActive && container.querySelector("a.active")) return;
            container.classList.remove("open");
        });
    }

    // âœ… active ë©”ë‰´ ìƒìœ„ ì—´ê¸° í•¨ìˆ˜
    function openParentMenusOfActive() {
        const activeLink = sidebar?.querySelector("a.active");
        if (!activeLink) return;
        let parent = activeLink.parentElement;
        while (parent && !parent.classList.contains("sidebar")) {
            if (parent.classList.contains("has-submenu")) {
                parent.classList.add("open");
            }
            parent = parent.parentElement;
        }
    }

    // âœ… ì‚¬ì´ë“œë°” ì „ì²´ í† ê¸€ (top.htmlì—ì„œ í˜¸ì¶œë¨)
    window.toggleSidebar = () => {
      if (!sidebar || !overlay) return;
      const isOpen = sidebar.classList.contains("open");
      
      sidebar.classList.toggle("open", !isOpen);
      overlay.classList.toggle("active", !isOpen);
      overlay.style.display = !isOpen ? "block" : "none";

      if (isOpen) {
          // ì‚¬ì´ë“œë°” ë‹«ì„ ë•Œ ì„œë¸Œë©”ë‰´ë„ ëª¨ë‘ ë‹«ê¸° (ë‹¨, active ìœ ì§€)
          closeAllSubmenus(true);
      } else {
          // âš¡ ì—´ë¦´ ë•ŒëŠ” 0.25ì´ˆ í›„ active ë©”ë‰´ ë³µì› (ì• ë‹ˆë©”ì´ì…˜ ë”œë ˆì´ ëŒ€ì‘)
          setTimeout(() => {
              openParentMenusOfActive();
          }, 250);
      }
    };

    // ğŸš¨ ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ
    overlay?.addEventListener("click", () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("active");
      overlay.style.display = "none";
      closeAllSubmenus(true); // ì„œë¸Œë©”ë‰´ ë‹«ê¸° í˜¸ì¶œ (active ìœ ì§€)
    });

    // ğŸš¨ í•µì‹¬: ë¬¸ì„œ ì „ì²´ í´ë¦­ ë¦¬ìŠ¤ë„ˆ (ì™¸ë¶€ í´ë¦­ ì‹œ ì„œë¸Œë©”ë‰´ ë‹«ê¸°)
    document.addEventListener("click", (e) => {
        const isClickInsideMenu = sidebar.contains(e.target);
        const isMenuToggleButton = e.target.closest("#menuToggle");

        if (!isClickInsideMenu && !isMenuToggleButton) {
            // ì„œë¸Œë©”ë‰´ë§Œ ë‹«ê¸°
            closeAllSubmenus(true); 
            
            // (ì„ íƒ ì‚¬í•­) ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ì‚¬ì´ë“œë°” ì „ì²´ë„ ë‹«ê¸°
            if (sidebar.classList.contains("open")) {
                window.toggleSidebar(); 
            }
        }
    });
    
    // âœ… ìµœì´ˆ ë¡œë“œì‹œ active ë©”ë‰´ ìë™ ë³µì›
    openParentMenusOfActive();

    overlay.style.display = "none";
  });
  </script>

  <!-- âœ… ê³µìš© ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="/js/common/common_loadseq_1_Loading_op.js"></script>
  <script src="/js/common/common_loadseq_2_Notify_op.js"></script>
  <script src="/js/common/common_loadseq_3_Pagination_op.js"></script>
  <script src="/js/common/common_loadseq_4_Modal_op.js"></script>
  <script src="/js/common/common_loadseq_5_UnifiedList_op.js"></script>
  <script src="/js/common/common_loadseq_6_Left_op.js"></script>
  
  

  <!-- âœ… í˜ì´ì§€ë³„ ìŠ¤í¬ë¦½íŠ¸ ì£¼ì… -->
  <th:block layout:fragment="pageScript"></th:block>

  <!-- âœ… ìë™ í—¤ë” ë†’ì´ ë°˜ì˜ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ğŸš© ëª¨ë°”ì¼ ë·°í¬íŠ¸(vh) ì•ˆì •í™” ë¡œì§ ì¶”ê°€ (URL ì°½ ë³€í™”ë¡œ ì¸í•œ ë ˆì´ì•„ì›ƒ 'ìš¸ì»¥' ë°©ì§€)
    function setVhUnit() {
      // í™”ë©´ ë†’ì´ë¥¼ 100ìœ¼ë¡œ ë‚˜ëˆˆ ê°’ì„ ê³„ì‚°
      const vh = window.innerHeight * 0.01;
      // CSS ë³€ìˆ˜ --vhì— ì„¤ì •: ì´ì œ CSSì—ì„œ height: calc(var(--vh) * 100) ì²˜ëŸ¼ ê³ ì • ë†’ì´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    // ğŸš©ğŸš©ğŸš© ìµœì¢… FIX ì¬ì ìš©: DOMContentLoaded ì „ì— ì¦‰ì‹œ setVhUnit()ì„ í˜¸ì¶œí•˜ì—¬ ìµœìš°ì„  ì ìš© ğŸš©ğŸš©ğŸš©
    setVhUnit(); 
    
    // resize ì´ë²¤íŠ¸ì™€ orientationchange ì´ë²¤íŠ¸ ì‹œì—ë„ vhë¥¼ ì¬ê³„ì‚°í•©ë‹ˆë‹¤. (ì¦‰ì‹œ ì ìš©)
    window.addEventListener("resize", setVhUnit); 
    window.addEventListener("orientationchange", setVhUnit); // ë°©í–¥ ì „í™˜ ì‹œì—ë„ ë†’ì´ ì¬ê³„ì‚°

    document.addEventListener("DOMContentLoaded", () => {
      // DOMContentLoaded ë‚´ë¶€ì—ëŠ” setVhUnit() í˜¸ì¶œ ë¶ˆí•„ìš”.
      // í•„ìš”í•œ ë‹¤ë¥¸ DOM ì¡°ì‘ ë¡œì§ë§Œ ì—¬ê¸°ì— ë‚¨ê¹ë‹ˆë‹¤.
    });
  </script>

</body>
</html>