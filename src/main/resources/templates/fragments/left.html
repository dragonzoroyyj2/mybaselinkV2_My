<!-- templates/fragments/left.html -->
<div th:fragment="leftFragment">
  <nav id="left" class="sidebar">
    <ul>
      <!-- 홈 -->
      <li>
        <a href="/pages/main/base"><i class="fas fa-home"></i><span>홈</span></a>
      </li>

      <!-- 리포트 관리 -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-file-alt"></i><span>리포트 관리</span>
          <i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
          <li><a href="/pages/p01/p01a05/p01a05List">기본테이블</a></li>
        </ul>
      </li>

      <!-- Job -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-chart-line"></i><span>Batch</span>
          <i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
          <li><a href="/pages/stock/stockBatchGProd">K-Stock Global Batch</a></li>
          <li><a href="/pages/stock/globalStockDashboard">globalStockDashboard</a></li>
        </ul>
      </li>

      <!-- Stock -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-chart-line"></i><span>K-Stock</span>
          <i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
          <li><a href="/pages/stock/stockList">K-Stock List</a></li>
          <li><a href="/pages/stock/stockBatchAthenaAi">Athena AI</a></li>
        </ul>
      </li>


      <!-- 관리 -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-server"></i><span>관리</span>
          <i class="fas fa-server-right toggle-icon"></i>
        </a>
        <ul class="submenu">
          <li><a href="/pages/sy/syfile/syFileStockPythonProd">Prod 파이썬 업로드</a></li>
          <li><a href="#">메뉴없음1</a></li>
          <li><a href="#">메뉴없음2</a></li>
        </ul>
      </li>

      <!-- 설정 -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-cog"></i><span>설정</span>
          <i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
          <li><a href="/pages/sy/syusr/syusr01List">사용자 관리</a></li>
          <li><a href="#">권한 설정</a></li>
        </ul>
      </li>
      
      
    </ul>
  </nav>

  <script>
  /* ===============================================================
     ✅ Sidebar Menu Control (v1.2 안정판)
     ---------------------------------------------------------------
     - 하위 메뉴 드롭아이콘 표시
     - 클릭 시 열기/닫기 토글
     - 현재 페이지(active) 자동 감지 후 부모 메뉴 자동 열기
     - 중복 초기화 방지 (fragment 로드 시 안전)
  =============================================================== */
  (function initLeftMenu() {
    const sidebar = document.querySelector(".sidebar");
    if (!sidebar || sidebar._menuInit) return; // ✅ 중복방지
    sidebar._menuInit = true;

    const currentUrl = location.pathname;

    // ✅ 모든 서브메뉴 닫기 (기본 상태)
    sidebar.querySelectorAll(".submenu").forEach(ul => ul.style.display = "none");

    // ✅ 서브메뉴 토글 기능
    sidebar.querySelectorAll(".submenu-toggle").forEach(toggle => {
      toggle.addEventListener("click", (e) => {
        e.preventDefault();
        const li = toggle.closest(".has-submenu");
        const submenu = li.querySelector(".submenu");
        const icon = toggle.querySelector(".toggle-icon");

        const isOpen = li.classList.contains("open");
        sidebar.querySelectorAll(".has-submenu").forEach(item => {
          item.classList.remove("open");
          const sub = item.querySelector(".submenu");
          const ico = item.querySelector(".toggle-icon");
          if (sub) sub.style.display = "none";
          if (ico) {
            ico.classList.remove("fa-chevron-down");
            ico.classList.add("fa-chevron-right");
          }
        });

        if (!isOpen) {
          li.classList.add("open");
          submenu.style.display = "block";
          if (icon) {
            icon.classList.remove("fa-chevron-right");
            icon.classList.add("fa-chevron-down");
          }
        }
      });
    });

    // ✅ 현재 URL 기준으로 active 메뉴 자동 설정
    sidebar.querySelectorAll(".submenu a, .sidebar > ul > li > a").forEach(link => {
      const href = link.getAttribute("href");
      if (href && currentUrl.startsWith(href)) {
        link.classList.add("active");

        // 부모 메뉴 열기
        const parent = link.closest(".has-submenu");
        if (parent) {
          parent.classList.add("open");
          const submenu = parent.querySelector(".submenu");
          const icon = parent.querySelector(".toggle-icon");
          if (submenu) submenu.style.display = "block";
          if (icon) {
            icon.classList.remove("fa-chevron-right");
            icon.classList.add("fa-chevron-down");
          }
        }
      }
    });
  })();
  </script>
</div>
