<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MyBaseLink ë¡œê·¸ì¸</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="manifest" href="/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">
<style>
/* í°íŠ¸ ê´€ë ¨ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ */
body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
  align-items: center;     /* ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
  font-family: "Pretendard", "Noto Sans KR", sans-serif;
  background: linear-gradient(135deg, #e5e7eb, #9ca3af, #6b7280);
  color: #fff;
  overflow: hidden; /* ì˜¤ë²„í”Œë¡œìš° ë°©ì§€ */
}

/* ========================================= */
/* ì „ì²´ ì»¨í…Œì´ë„ˆ: ì°¨íŠ¸ì™€ í¼ì„ ë¬¶ì–´ ì¤‘ì•™ì— ê³ ì • */
/* ========================================= */
.main-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 340px; 
  position: relative; /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ì˜ ê¸°ì¤€ì  */
}


/* ========================================= */
/* íŒì—… ë©”ì‹œì§€ (í† ìŠ¤íŠ¸) ìŠ¤íƒ€ì¼ - ìƒ‰ìƒ ê°œì„  ë° ëª¨ë˜í™” */
/* ========================================= */
#toastMessage {
    position: absolute; 
    top: 155px; /* ì°¨íŠ¸ ë†’ì´(150px) + ì•½ê°„ì˜ ì—¬ë°± */
    left: 50%;
    transform: translate(-50%, 0) scale(0.95); 
    z-index: 200; 
    padding: 10px 20px;
    border-radius: 8px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5); /* ê·¸ë¦¼ì ê°•ì¡° */
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.4s ease-out, visibility 0.4s ease-out, transform 0.4s ease-out;
    font-size: 0.9rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    min-width: 180px;
    text-align: center;
    backdrop-filter: blur(5px); /* ìœ ë¦¬ íš¨ê³¼ ì¶”ê°€ */
    border: 1px solid rgba(255, 255, 255, 0.1); /* í…Œë‘ë¦¬ ì¶”ê°€ */
}

#toastMessage.show {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -10px) scale(1.0); /* ì•½ê°„ ìœ„ë¡œ ì˜¬ë¼ì˜¤ë©´ì„œ ë‚˜íƒ€ë‚¨ */
}

/* ìƒ‰ìƒ ì¡°ì •: íšŒìƒ‰í†¤ì— ë§ì¶° ê³ ê¸‰ìŠ¤ëŸ½ê²Œ ë³€ê²½ */
#toastMessage.success {
    /* ì§™ì€ ì²­ë¡ìƒ‰ ê³„ì—´ (Dark Teal/Slate) */
    background-color: rgba(30, 91, 80, 0.95); /* ì´ì „ ë…¹ìƒ‰ë³´ë‹¤ í›¨ì”¬ ì–´ë‘¡ê³  ì°¨ë¶„í•˜ê²Œ */
    color: #e5e7eb; /* ë°ì€ íšŒìƒ‰ í°íŠ¸ */
}
#toastMessage.error {
    /* ì§™ì€ ë¶‰ì€ìƒ‰ ê³„ì—´ (Dark Maroon/Red) */
    background-color: rgba(150, 40, 40, 0.95); /* ì´ì „ ë¹¨ê°•ë³´ë‹¤ í›¨ì”¬ ì–´ë‘¡ê³  ì°¨ë¶„í•˜ê²Œ */
    color: #fff;
}
#toastMessage.warning {
    /* ë°ì§€ë§Œ íŠ€ì§€ ì•ŠëŠ” ìƒ‰ìƒ (Glassy Light Gray) */
    background-color: rgba(255, 255, 255, 0.85); /* íˆ¬ëª…ë„ë¥¼ ë†’ì—¬ ë’·ë°°ê²½ì´ ì‚´ì§ ë¹„ì¹˜ê²Œ */
    color: #4b5563; /* ì–´ë‘ìš´ íšŒìƒ‰ í°íŠ¸ */
}

#toastMessage i {
  margin-right: 8px;
  font-size: 1.1rem;
}
/* ========================================= */


/* ì¶”ê°€: ë¡œë”© ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ - ë°°ê²½ í´ë¦­ ë°©ì§€ */
#loadingOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4); 
  z-index: 100; 
  display: none; 
  cursor: wait; 
  pointer-events: auto; 
}


.login-container {
  width: 100%;
  max-width: 340px; 
  margin: 0 5vw;
  padding: 2rem 1.5rem; 
  background: rgba(255, 255, 255, 0.15);
  border-radius: 16px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.25);
  backdrop-filter: blur(12px);
  text-align: center;
  color: #fff;
  animation: fadeIn 0.9s ease;
  box-sizing: border-box;
  border: 1px solid rgba(255,255,255,0.2);
  position: relative;
  z-index: 2; 
}

/* ========================================= */
/* .chart-container ìŠ¤íƒ€ì¼ (ì´í•˜ ê·¸ëŒ€ë¡œ ìœ ì§€) */
/* ========================================= */
.chart-container {
  width: 100%; 
  max-width: 340px; 
  height: 150px;
  margin: 0 auto 1.5px auto;
  padding: 0 1.5rem; 
  box-sizing: border-box; 
  position: relative;
  z-index: 1;
}

.chart-container canvas {
  width: 100%; 
  height: 100%;
}

#toggleRepeatIcon {
  position:absolute; top:5px; left:5px; font-size:22px;
  color: rgba(255,255,255,0.9); cursor:pointer; z-index:10;
  transition: all 0.2s;
}

.login-container h2 {
  margin-bottom: 1.2rem;
  font-weight: 700;
  font-size: 1.3rem;
  letter-spacing: 0.5px;
}

.input-group {
  position: relative;
  margin-bottom: 1rem;
  width: 100%;
}

.input-group input {
  width: 100%;
  max-width: 100%;
  padding: 10px 40px 10px 14px;
  border: none;
  border-radius: 10px;
  outline: none;
  background: rgba(255,255,255,0.9);
  color: #333;
  font-size: 0.9rem;
  transition: all 0.25s ease;
  box-sizing: border-box;
}

.input-group input:focus {
  background: #fff;
  box-shadow: 0 0 0 2px #9ca3af;
}

.input-group i {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: #666;
  font-size: 0.9rem;
}

button {
  width: 100%;
  max-width: 100%;
  padding: 10px;
  border: none;
  border-radius: 10px;
  background: linear-gradient(90deg,#6b7280,#4b5563);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
  font-size: 0.95rem;
  margin-top: 0.5rem;
  box-sizing: border-box;
  opacity: 1;
  pointer-events: auto;
}

button:hover:not(.loading-btn) { 
  background: linear-gradient(90deg,#4b5563,#374151);
  transform: translateY(-2px);
}

/* ========================================= */
/* ë¡œë”© ìŠ¤í”¼ë„ˆ ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì´í•˜ ê·¸ëŒ€ë¡œ ìœ ì§€) */
/* ========================================= */
button.loading-btn {
  background: #4b5563; 
  cursor: not-allowed;
  transform: none; 
  opacity: 0.85;
}

.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
  vertical-align: middle;
  margin-right: 8px; 
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.button-text {
  vertical-align: middle;
}

/* ========================================= */

.login-footer {
  margin-top: 1rem;
  font-size: 0.8rem;
  color: #d1d5db;
}

.login-footer a {
  color: #e5e7eb;
  text-decoration: none;
}

.login-footer a:hover {
  text-decoration: underline;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ========================================= */
/* ë¯¸ë””ì–´ ì¿¼ë¦¬ (ì´í•˜ ê·¸ëŒ€ë¡œ ìœ ì§€) */
/* ========================================= */
@media (max-width:400px){
  .login-container{padding:1.8rem 1.2rem;margin:0 6vw;}
  .input-group input, button{padding-left:14px;padding-right:40px;}
  .chart-container{
    max-width: 100%; 
    padding: 0 1.2rem; 
  } 
}
</style>
</head>

<body>

<div id="loadingOverlay"></div>

<div class="main-wrapper">
    <div id="toastMessage"></div> 

    <div class="chart-container">
      <canvas id="candleChart" height="150"></canvas>
      <i id="toggleRepeatIcon" class="fas fa-pause-circle" title="ë°˜ë³µ ì‹œì‘/ì •ì§€"></i>
    </div>
    
    <div class="login-container">
      <h2>ğŸ” MyBaseLink ë¡œê·¸ì¸</h2>

      <div class="input-group">
        <input type="text" id="username" placeholder="ì•„ì´ë””" />
        <i class="fas fa-user"></i>
      </div>

      <div class="input-group">
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
        <i class="fas fa-lock"></i>
      </div>

      <button id="loginBtn">
        <span class="button-text">ë¡œê·¸ì¸</span>
      </button>

      <div class="login-footer">
        <p>ê³„ì •ì´ ì—†ë‚˜ìš”? <a href="#">íšŒì›ê°€ì…</a></p>
      </div>
    </div>
</div>

<script>
// ==================== ì•Œë¦¼ ëª¨ë‹¬ ë¡œì§ (ì¶”ê°€) ====================
const toastMessage = document.getElementById("toastMessage");

/**
 * ì‚¬ìš©ìì—ê²Œ ë©‹ì§„ ì•Œë¦¼ ëª¨ë‹¬ì„ í‘œì‹œí•©ë‹ˆë‹¤.
 * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
 * @param {string} type - 'success', 'error', 'warning' ì¤‘ í•˜ë‚˜
 */
function showAlertModal(message, type) {
    let icon;
    // ê¸°ì¡´ í´ë˜ìŠ¤ ì´ˆê¸°í™”
    toastMessage.className = '';
    
    switch (type) {
        case 'success':
            icon = 'fas fa-check-circle';
            toastMessage.classList.add('success');
            break;
        case 'error':
            icon = 'fas fa-times-circle';
            toastMessage.classList.add('error');
            break;
        case 'warning':
        default:
            icon = 'fas fa-exclamation-triangle';
            toastMessage.classList.add('warning');
            break;
    }
    
    toastMessage.innerHTML = `<i class="${icon}"></i>${message}`;
    
    // ëª¨ë‹¬ í‘œì‹œ
    toastMessage.classList.add('show');

    // 2ì´ˆ í›„ ìˆ¨ê¸°ê¸°
    setTimeout(() => {
        toastMessage.classList.remove('show');
    }, 2000); 
}
// ==========================================================


// ==================== í”Œë˜ê·¸ & ì•„ì´ì½˜ (ê·¸ëŒ€ë¡œ ìœ ì§€) ====================
let repeatChart = true;
let animationId = null;
let chartOpacity = 0.7;
let holdTime=0;
const icon = document.getElementById("toggleRepeatIcon");

function updateIcon(){
  if(repeatChart){
    icon.className="fas fa-pause-circle";
    icon.style.color="rgba(255,255,255,0.9)";
    icon.title="ë°˜ë³µ ì¤‘ (í´ë¦­ ì‹œ ì¤‘ì§€)";
  } else {
    icon.className="fas fa-play-circle";
    icon.style.color="rgba(255,255,255,0.6)";
    icon.title="ë°˜ë³µ ì¤‘ì§€ (í´ë¦­ ì‹œ ì‹œì‘)";
  }
}
updateIcon();
icon.addEventListener("click", ()=>{
  repeatChart=!repeatChart;
  updateIcon();
  if(repeatChart && animationId===null){
    fadeOpacity=chartOpacity;
    drawCandles();
  } else if(!repeatChart && animationId!==null){
    cancelAnimationFrame(animationId);
    animationId=null;
  }
});

// ==================== ë¡œê·¸ì¸ (í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì ìš©) ====================
const loginBtn = document.getElementById("loginBtn");
const buttonText = loginBtn.querySelector(".button-text");
const loadingOverlay = document.getElementById("loadingOverlay"); 

/** ë¡œë”© ìŠ¤í”¼ë„ˆë¥¼ í‘œì‹œí•˜ê³  ë²„íŠ¼ì„ ë¹„í™œì„±í™”í•˜ë©°, ì˜¤ë²„ë ˆì´ë¥¼ ê³  ë°°ê²½ í´ë¦­ì„ ë§‰ìŠµë‹ˆë‹¤. */
function showLoading() {
  loginBtn.classList.add("loading-btn");
  loginBtn.disabled = true;
  buttonText.innerHTML = '<div class="spinner"></div> ë¡œë”© ì¤‘...';
  loadingOverlay.style.display = 'block'; // ì˜¤ë²„ë ˆì´ í‘œì‹œ
}

/** ë²„íŠ¼ì„ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ê³  í™œì„±í™”í•˜ë©°, ì˜¤ë²„ë ˆì´ë¥¼ ë•ë‹ˆë‹¤. */
function hideLoading() {
  loginBtn.classList.remove("loading-btn");
  loginBtn.disabled = false;
  buttonText.innerHTML = 'ë¡œê·¸ì¸';
  loginBtn.style.background = ''; // CSS ê·¸ë¼ë””ì–¸íŠ¸ë¡œ ë³µê·€
  loadingOverlay.style.display = 'none'; // ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
}


loginBtn.addEventListener("click", async ()=>{
  const username=document.getElementById("username").value.trim();
  const password=document.getElementById("password").value.trim();
  
  if(!username||!password){
    // ê¸°ì¡´ alert ëŒ€ì‹  í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì‚¬ìš©
    showAlertModal("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.", 'warning'); 
    return;
  }

  showLoading(); // ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ ë° ì˜¤ë²„ë ˆì´ í™œì„±í™”

  try{
    // *** ì„œë²„ ì£¼ì†Œ í™•ì¸: /auth/loginì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ 
    // fetch("http://localhost:8080/auth/login", ...)ì²˜ëŸ¼ ì „ì²´ ì£¼ì†Œë¥¼ ì‚¬ìš©í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    const res=await fetch("/auth/login",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({username,password})
    });

    if(res.ok){
      // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
      const data=await res.json();
      localStorage.setItem("token",data.token);
      localStorage.setItem("username",data.username);
      localStorage.setItem("sessionMillis",data.sessionMillis);
      localStorage.setItem("serverTime",data.serverTime);
      
      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¡œ ì„±ê³µ ì•Œë¦¼
      showAlertModal("ë¡œê·¸ì¸ ì„±ê³µ! í™˜ì˜í•©ë‹ˆë‹¤.", 'success');
      
      // ë¡œë”© ë²„íŠ¼ì— ì„±ê³µ UI í‘œì‹œ (ì˜¤ë²„ë ˆì´ëŠ” ìœ ì§€)
      loginBtn.classList.remove("loading-btn");
      loginBtn.disabled = true; 
      loginBtn.style.background = '#10b981'; // ì´ˆë¡ìƒ‰ ë°°ê²½
      buttonText.innerHTML = '<i class="fas fa-check-circle"></i> ë¡œê·¸ì¸ ì„±ê³µ!';
      
      // 1ì´ˆ(1000ms) í›„ í˜ì´ì§€ ì´ë™ ë° ì˜¤ë²„ë ˆì´ ì œê±°
      setTimeout(() => {
        loadingOverlay.style.display = 'none'; 
        location.href="/pages/main/base"; // ì‹¤ì œ í˜ì´ì§€ ì´ë™ ê²½ë¡œ
      }, 1000); 

    } else { 
      // ë¡œê·¸ì¸ ì‹¤íŒ¨ ì²˜ë¦¬
      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¡œ ì‹¤íŒ¨ ì•Œë¦¼
      showAlertModal("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", 'error');

      // ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
      loginBtn.classList.remove("loading-btn");
      loginBtn.disabled = true; 
      loginBtn.style.background = '#ef4444'; // ë¹¨ê°„ìƒ‰ ë°°ê²½
      buttonText.innerHTML = '<i class="fas fa-times-circle"></i> ë¡œê·¸ì¸ ì‹¤íŒ¨ âŒ';
      
      // 1.5ì´ˆ í›„ ë²„íŠ¼ ì´ˆê¸°í™” ë° ì˜¤ë²„ë ˆì´ ì œê±°
      setTimeout(() => {
        hideLoading(); 
      }, 1500); 
    }
  }catch(err){
    // ì„œë²„ ì˜¤ë¥˜ ì²˜ë¦¬
    console.error(err); 
    
    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¡œ ì„œë²„ ì˜¤ë¥˜ ì•Œë¦¼
    showAlertModal("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", 'error');

    loginBtn.classList.remove("loading-btn");
    loginBtn.disabled = true; 
    loginBtn.style.background = '#ef4444'; 
    buttonText.innerHTML = '<i class="fas fa-times-circle"></i> ì„œë²„ ì˜¤ë¥˜ âŒ';
    
    // 1.5ì´ˆ í›„ ë²„íŠ¼ ì´ˆê¸°í™” ë° ì˜¤ë²„ë ˆì´ ì œê±°
    setTimeout(() => {
      hideLoading(); 
    }, 1500);
  }
});


// ==================== ë´‰ì°¨íŠ¸ (ì´í•˜ ê·¸ëŒ€ë¡œ ìœ ì§€) ====================
const candleCount=13;
let candles=[],index=0,fadeOpacity=chartOpacity;
const canvasContainer = document.querySelector('.chart-container');
const canvas=document.getElementById("candleChart");
const ctx=canvas.getContext("2d");
const width = 15;

/** ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ì»¨í…Œì´ë„ˆì— ë§ê²Œ ì¡°ì ˆí•˜ê³ , ì°¨íŠ¸ë¥¼ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤. */
function resizeCanvas() {
    canvas.width = canvasContainer.clientWidth;
    canvas.height = 150; 
}

// ì´ˆê¸° í¬ê¸° ì„¤ì • ë° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
resizeCanvas();
window.addEventListener('resize', () => {
    resizeCanvas();
    resetCandles(); 
    if(animationId === null) {
      drawCandles(); 
    }
});


function resetCandles(){
  candles=[]; index=0; fadeOpacity=chartOpacity; holdTime=0;
  const minH=20;
  for(let i=0;i<candleCount-1;i++){
    let base=minH+i*5;
    let noise=Math.floor(Math.random()*10)-5;
    let height=base+noise;
    const color=(i%2===0)?`rgba(59,130,246,${0.5+Math.random()*0.2})`:`rgba(239,68,68,${0.5+Math.random()*0.2})`;
    candles.push({targetHeight:height,currentHeight:0,color});
  }
  const lastHeight=Math.floor(candles[candleCount-2].targetHeight*1.3);
  candles.push({targetHeight:lastHeight,currentHeight:0,color:`rgba(239,68,68,0.9)`});
}

function drawCandles(){
  ctx.clearRect(0,0,canvas.width,canvas.height); 
  const spacing=(canvas.width-candleCount*width)/(candleCount-1); 

  // ë´‰ ê·¸ë¦¬ê¸°
  for(let i=0;i<=index;i++){
    const c=candles[i];
    const speed=(i===candleCount-1)?6:3+Math.random()*2;
    if(c.currentHeight<c.targetHeight)c.currentHeight+=speed;
    if(c.currentHeight>c.targetHeight)c.currentHeight=c.targetHeight;
    const x=i*(width+spacing);
    const y=canvas.height-c.currentHeight;
    ctx.fillStyle=c.color;
    ctx.fillRect(x,y,width,c.currentHeight);
  }

  // ë¼ì¸ ê·¸ë¼ë””ì–¸íŠ¸
  const gradient=ctx.createLinearGradient(0,0,canvas.width,0); 
  gradient.addColorStop(0,"rgba(248,113,113,"+fadeOpacity+")");
  gradient.addColorStop(0.5,"rgba(59,130,246,"+fadeOpacity+")");
  gradient.addColorStop(1,"rgba(248,113,113,"+fadeOpacity+")");

  // ì§€ê·¸ì¬ê·¸ ë¼ì¸
  ctx.beginPath();
  ctx.strokeStyle=gradient;
  ctx.lineWidth=2;
  for(let i=0;i<=index;i++){
    const c=candles[i];
    const x=i*(width+spacing)+width/2;
    const y=canvas.height-c.currentHeight-10;
    if(i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }
  ctx.stroke();

  // ë§ˆì§€ë§‰ í™”ì‚´í‘œ + ë°˜ì§ì„ ì „ì²´
  if(index>=candleCount-1){
    const last=candles[candleCount-1];
    const lx=canvas.width-width/2-1; 
    const ly=canvas.height-last.currentHeight-10;
    const arrowWidth=Math.min(22,canvas.width-lx-2); 
    const arrowHeight=14;

    const glowAlpha=0.5+0.5*Math.sin(Date.now()/100);
    // í™”ì‚´í‘œ
    ctx.beginPath();
    ctx.moveTo(lx, ly-arrowHeight/2);
    ctx.lineTo(lx, ly+arrowHeight/2);
    ctx.lineTo(lx+arrowWidth, ly);
    ctx.closePath();
    ctx.fillStyle=`rgba(248,113,113,${glowAlpha})`;
    ctx.fill();

    // ë¼ì¸ ëì  ë°˜ì§ì„
    ctx.fillStyle=`rgba(255,255,255,${0.2+0.3*Math.sin(Date.now()/80)})`;
    for(let i=0;i<5;i++){
      const offsetX=Math.random()*2;
      const offsetY=Math.random()*2-1;
      ctx.beginPath();
      ctx.arc(lx+arrowWidth, ly+offsetY,1.5,0,2*Math.PI);
      ctx.fill();
    }
  }

  if(index<candleCount-1 && candles[index].currentHeight>=candles[index].targetHeight) index++;

  if(index>=candleCount-1){
    if(holdTime<45){holdTime++;}
    else{fadeOpacity-=0.02;if(fadeOpacity<0)fadeOpacity=0;}
  }

  if(fadeOpacity>0){
    animationId=requestAnimationFrame(drawCandles);
  } else {
    animationId=null;
    if(repeatChart){
      setTimeout(()=>{
        resetCandles();
        drawCandles();
      },2000);
    }
  }
}

resetCandles();
drawCandles();
</script>

</body>
</html>