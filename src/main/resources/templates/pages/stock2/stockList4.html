<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<head>
  <meta charset="UTF-8">
  <title>주식 종목 리스트</title>

  <!-- Font Awesome은 default_layout에서 이미 포함 -->
  <!-- 공용 CSS는 default_layout에서 이미 포함 -->
</head>

<body>
<div layout:fragment="content">
  <div class="content-container">
    <h2>📊 주식 종목 리스트</h2>

    <!-- 검색 라인 -->
    <div class="toolbar">
      <div class="search-group">
        <input type="text" id="searchInput" placeholder="검색어 입력" />
        <button id="searchBtn" class="btn"><i class="fas fa-search"></i></button>
        <button class="btn"><i class="fas fa-filter"></i></button>
        <button class="btn"><i class="fas fa-sync-alt"></i></button>
      </div>
    </div>

    <!-- 총건 + 기능 버튼 -->
    <div class="list-info">
      <span id="totalCount">총 0건</span>
      <div class="action-buttons">
        <button id="excelBtn" class="btn excel" title="엑셀 다운로드"><i class="fa-solid fa-file-excel"></i></button>
        <button id="addBtn" class="btn" title="추가"><i class="fas fa-plus"></i></button>
        <button id="deleteSelectedBtn" class="btn red" title="삭제"><i class="fas fa-trash"></i></button>
      </div>
    </div>

    <!-- 테이블 -->
    <div class="table-container">
      <table>
        <thead>
        <tr>
          <th><input type="checkbox" id="checkAll" /></th>
          <th>No</th>
          <th>종목코드</th>
          <th>회사명</th>
          <th>시장구분</th>
          <th>업종</th>
          <th>종가</th>
          <th>시가</th>
          <th>고가</th>
          <th>저가</th>
          <th>거래량</th>
          <th>기준일</th>
        </tr>
        </thead>
        <tbody id="dataTable"></tbody>
      </table>
    </div>

    <!-- 페이징 -->
    <div id="pagination" class="pagination"></div>
  </div>

  <!-- 등록 모달 -->
  <div id="addModal" class="modal">
    <div class="elegant-modal">
      <div class="elegant-header">
        <h3>서버 등록</h3>
        <span data-close="addModal" class="close-btn">&times;</span>
      </div>
      <div class="elegant-body">
        <div class="form-group"><label>제목</label><input id="titleInput" /></div>
        <div class="form-group"><label>담당자</label><input id="ownerInput" /></div>
        <div class="form-group"><label>서버 종류</label>
          <select id="serverType"><option>웹 서버</option><option>DB 서버</option><option>API 서버</option></select>
        </div>
        <div class="form-group"><label>운영 상태</label>
          <div class="option-group">
            <label><input type="radio" name="status" value="active" checked>운영</label>
            <label><input type="radio" name="status" value="pause">중지</label>
          </div>
        </div>
        <div class="form-group"><label>기능 옵션</label>
          <div class="option-group">
            <label><input type="checkbox">백업 활성화</label>
            <label><input type="checkbox">자동 모니터링</label>
          </div>
        </div>
        <div class="form-group"><label>등록일</label><input type="date" id="regDateInput" /></div>
        <div class="form-group"><label>비고</label><textarea id="noteInput" rows="3"></textarea></div>
      </div>
      <div class="modal-footer elegant-footer">
        <button id="saveBtn" class="btn">저장</button>
        <button class="btn gray" data-close="addModal">닫기</button>
      </div>
    </div>
  </div>

  <!-- 상세 / 수정 모달 -->
  <div id="detailModal" class="modal">
    <div class="elegant-modal">
      <div class="elegant-header">
        <h3>상세 정보</h3>
        <span data-close="detailModal" class="close-btn">&times;</span>
      </div>
      <div class="elegant-body">
        <div class="form-group"><label>No</label><input id="detailId" readonly /></div>
        <div class="form-group"><label>제목</label><input id="detailTitle" /></div>
        <div class="form-group"><label>담당자</label><input id="detailOwner" /></div>
        <div class="form-group"><label>등록일</label><input id="detailRegDate" readonly /></div>
        <div class="form-group"><label>서버 상태</label>
          <select><option>정상</option><option>점검중</option></select>
        </div>
        <div class="form-group"><label>기능 옵션</label>
          <div class="option-group">
            <label><input type="checkbox">백업 활성화</label>
            <label><input type="checkbox">자동 모니터링</label>
          </div>
        </div>
        <div class="form-group"><label>비고</label><textarea id="detailNote" rows="3"></textarea></div>
      </div>
      <div class="modal-footer elegant-footer">
        <button id="updateBtn" class="btn">수정</button>
        <button class="btn gray" data-close="detailModal">닫기</button>
      </div>
    </div>
  </div>
</div>

<!-- 페이지별 초기화 -->
<th:block layout:fragment="pageScript">

<script>
document.addEventListener("DOMContentLoaded", () => {

  // ✅ 1. 반응형 페이지 그룹 크기 계산
  function getPageGroupSize() {
    const width = window.innerWidth;
    if (width < 480) return 3;
    if (width < 768) return 5;
    if (width < 1024) return 10;
    return 20;
  }

  let pageGroupSize = getPageGroupSize();

  // ✅ 2. 공용 리스트 초기화
  const unifiedListManager = initUnifiedList({
    mode: "server",	// client or server
    pagination: true,
    apiUrl: "/api/stockList/list",
    tableBodySelector: "#dataTable",
    paginationSelector: "#pagination",
    searchInputSelector: "#searchInput",
    searchBtnSelector: "#searchBtn",
    addBtnSelector: "#addBtn",
    deleteSelectedBtnSelector: "#deleteSelectedBtn",
    excelBtnSelector: "#excelBtn",
    modalId: "#addModal",
    detailModalId: "#detailModal",
    pageSize: 10,
    pageGroupSize: pageGroupSize,

    // ✅ 버튼 활성화
    buttons: {
      search: true,
      searchInput: true,
      add: false,
      deleteSelected: false,
      excel: true
    },

    // ✅ 상세 설정 (둘 다 가능)
    enableRowClickDetail: true, // 행 클릭 시 상세 열림
    enableDetailView: true,     // 상세 모달 사용
    detailViewButtons: {
      update: false,
      delete: false
    },

    // ✅ 컬럼 정의 (isDetailLink 유지 → 컬럼 클릭도 가능)
    columns: [
      { key: "id", label: "No" },
      { key: "Code", label: "종목코드", isDetailLink: true },
      { key: "Name", label: "회사명" , isDetailLink: true },
      { key: "Market", label: "시장구분" },
      { key: "Dept", label: "업종" },
      { key: "Close", label: "종가" },
      { key: "Open", label: "시가" },
      { key: "High", label: "고가" },
      { key: "Low", label: "저가" },
      { key: "Volume", label: "거래량" },
      { key: "Date", label: "기준일" }
    ],

    // ✅ 공통 Hook (각 페이지에서 오버라이드 가능)
    onAddModalOpen: () => console.log("➕ Add Modal Open"),
    onDetailModalOpen: (id) => console.log("🔍 Detail Modal Open:", id),
    onDeleteSuccess: (ids) => console.log("🗑️ Deleted:", ids)
    
    
  });

  // ✅ 3. 페이지별 커스텀 기능 예시 (원하면 확장 가능)
  const addUserBtn = document.getElementById("addUserBtn");
  if (addUserBtn) {
    addUserBtn.addEventListener("click", () => {
      alert("👤 사용자 추가 모달 여는 커스텀 로직 실행");
    });
  }

  const customFilterBtn = document.getElementById("customFilterBtn");
  if (customFilterBtn) {
    customFilterBtn.addEventListener("click", () => {
      alert("🎯 커스텀 필터 실행");
      unifiedListManager.loadList(0, "web", "filter=active");
    });
  }

  
});
</script>

</th:block>


</body>
</html>
